reset
set duplicate block elements on

create vertex -1048.15 1012.96 0
create vertex -1085.19 931.481 0
create vertex -1092.59 866.667 0
create vertex -1129.63 811.11 0
create vertex -1159.26 761.111 0
create vertex -1188.89 705.556 0
create vertex -1200 674.074 0
create vertex -1174.07 644.444 0
create vertex -1161.11 603.704 0
create vertex -1162.96 551.852 0
create vertex -1162.96 505.556 0
create vertex -1174.07 474.074 0

create vertex -1083.33 1016.67 0
create vertex -1111.11 951.852 0
create vertex -1118.52 874.074 0
create vertex -1166.67 800 0
create vertex -1196.3 772.222 0
create vertex -1224.07 712.963 0
create vertex -1224.07 668.519 0
create vertex -1207.41 627.778 0
create vertex -1201.85 575.926 0
create vertex -1201.85 531.481 0
create vertex -1198.15 501.852 0
create vertex -1216.67 457.407 0

create vertex -1135.19 1012.96 0
create vertex -1155.56 981.481 0
create vertex -1166.67 900 0
create vertex -1212.96 818.519 0
create vertex -1233.33 738.889 0
create vertex -1255.56 716.667 0
create vertex -1264.81 668.519 0
create vertex -1257.41 635.185 0
create vertex -1248.15 603.704 0
create vertex -1248.15 500 0
create vertex -1262.96 453.704 0

create vertex -1162.96 1012.96 0
create vertex -1196.3 957.407 0
create vertex -1194.44 901.852 0
create vertex -1235.19 837.037 0
create vertex -1250 750 0
create vertex -1288.89 716.667 0
create vertex -1292.59 618.519 0
create vertex -1281.48 588.889 0
create vertex -1300 542.593 0
create vertex -1281.48 461.111 0
create vertex -1296.3 446.296 0

create vertex -1262.96 1016.67 0
create vertex -1261.11 938.889 0
create vertex -1292.59 894.444 0
create vertex -1312.96 825.926 0
create vertex -1296.3 772.222 0
create vertex -1298.15 759.259 0
create vertex -1327.78 705.556 0
create vertex -1337.04 661.111 0
create vertex -1342.59 585.185 0
create vertex -1379.63 546.296 0
create vertex -1388.89 501.852 0
create vertex -1383.33 448.148 0

create vertex -1312.96 1012.96 0
create vertex -1288.89 937.037 0
create vertex -1311.11 909.259 0
create vertex -1319.07 894.444 0
create vertex -1316.78 835.185 0
create vertex -1325.93 775.926 0
create vertex -1340.74 716.667 0
create vertex -1351.85 672.222 0
create vertex -1362.96 616.667 0
create vertex -1359.26 581.481 0
create vertex -1381.48 559.259 0
create vertex -1394.44 527.778 0
create vertex -1390.74 450 0

create vertex -1381.48 1016.67 0
create vertex -1357.41 981.481 0
create vertex -1340.74 951.852 0
create vertex -1340.74 900 0
create vertex -1327.78 883.333 0
create vertex -1329.93 792.593 0
create vertex -1329.93 775.926 0
create vertex -1346.44 703.704 0
create vertex -1368.52 642.593 0
create vertex -1377.78 616.667 0
create vertex -1379.63 592.593 0
create vertex -1385.19 575.926 0
create vertex -1396.30 548.148 0
create vertex -1398.15 507.407 0
create vertex -1398.15 474.074 0
create vertex -1394.44 451.852 0

create vertex -1405.56 1014.81 0
create vertex -1372.22 957.407 0
create vertex -1374.07 911.111 0
create vertex -1359.26 857.407 0
create vertex -1361.11 818.519 0
create vertex -1374.07 801.852 0
create vertex -1366.67 750 0
create vertex -1361.11 724.074 0
create vertex -1355.56 696.296 0
create vertex -1364.26 659.259 0
create vertex -1379.63 616.667 0
create vertex -1387.04 588.889 0
create vertex -1407.41 551.852 0
create vertex -1407.41 518.519 0
create vertex -1409.26 475.926 0
create vertex -1403.7 448.148 0

create vertex -1429.63 1016.67 0
create vertex -1401.85 972.222 0
create vertex -1398.15 868.519 0
create vertex -1374.07 846.296 0
create vertex -1400.00 831.481 0
create vertex -1405.56 805.556 0
create vertex -1414.81 759.259 0
create vertex -1409.26 700 0
create vertex -1414.81 631.481 0
create vertex -1425.93 588.889 0
create vertex -1435.19 512.963 0
create vertex -1444.44 459.259 0

create vertex -1466.67 1012.96 0
create vertex -1427.78 972.222 0
create vertex -1420.37 887.037 0
create vertex -1425.93 835.185 0
create vertex -1429.63 783.333 0
create vertex -1427.78 731.481 0
create vertex -1420.37 677.778 0
create vertex -1431.48 633.333 0
create vertex -1437.04 588.889 0
create vertex -1444.44 525.926 0
create vertex -1455.56 462.963 0

create vertex -1501.85 1014.81 0
create vertex -1461.11 970.37 0
create vertex -1457.41 924.074 0
create vertex -1461.11 894.444 0
create vertex -1462.96 868.519 0
create vertex -1472.22 835.185 0
create vertex -1466.67 809.259 0
create vertex -1462.96 762.963 0
create vertex -1461.11 712.963 0
create vertex -1464.81 655.556 0
create vertex -1461.11 624.074 0
create vertex -1459.26 596.296 0
create vertex -1470.37 583.333 0
create vertex -1477.78 559.259 0
create vertex -1494.44 520.37 0
create vertex -1490.74 500 0
create vertex -1481.48 468.519 0

create vertex -1511.11 1009.26 0
create vertex -1475.93 961.111 0
create vertex -1474.07 914.815 0
create vertex -1492.59 851.852 0
create vertex -1490.74 809.259 0
create vertex -1479.63 761.111 0
create vertex -1477.78 714.815 0
create vertex -1481.48 627.778 0
create vertex -1498.15 579.63 0
create vertex -1507.41 527.778 0
create vertex -1491.04 487.037 0
create vertex -1503.70 448.148 0

create vertex -1520.37 1005.56 0
create vertex -1488.89 942.593 0
create vertex -1487.04 896.296 0
create vertex -1503.70 840.741 0
create vertex -1507.41 794.444 0
create vertex -1500.00 746.296 0
create vertex -1488.89 701.852 0
create vertex -1496.30 655.556 0
create vertex -1525.93 605.556 0
create vertex -1527.78 540.741 0
create vertex -1516.67 500 0
create vertex -1503.70 470.37 0
create vertex -1529.63 451.852 0

create vertex -1540.74 1009.26 0
create vertex -1505.56 946.296 0
create vertex -1505.56 883.333 0
create vertex -1527.78 824.074 0
create vertex -1527.78 790.741 0
create vertex -1503.70 724.074 0
create vertex -1511.11 670.37 0
create vertex -1550.00 603.704 0
create vertex -1544.44 555.556 0
create vertex -1551.85 483.333 0
create vertex -1590.74 446.296 0

create vertex -1592.59 1016.67 0
create vertex -1551.85 959.259 0
create vertex -1542.59 894.444 0
create vertex -1555.56 831.481 0
create vertex -1562.96 781.481 0
create vertex -1544.44 727.778 0
create vertex -1557.41 687.037 0
create vertex -1574.07 651.852 0
create vertex -1620.37 590.741 0
create vertex -1616.67 512.963 0
create vertex -1651.85 459.259 0

create vertex -1614.81 1016.67 0
create vertex -1583.33 974.074 0
create vertex -1564.81 914.815 0
create vertex -1575.93 842.593 0
create vertex -1583.33 777.778 0
create vertex -1572.22 731.481 0
create vertex -1587.04 700 0
create vertex -1600.00 666.667 0
create vertex -1638.89 612.963 0
create vertex -1664.81 599.259 0
create vertex -1648.15 518.519 0
create vertex -1705.56 461.111 0

create vertex -1635.19 1014.81 0
create vertex -1594.44 938.889 0
create vertex -1587.04 866.667 0
create vertex -1598.15 807.407 0
create vertex -1607.41 751.852 0
create vertex -1607.41 731.481 0
create vertex -1644.44 664.815 0
create vertex -1705.56 574.074 0
create vertex -1698.15 542.593 0
create vertex -1712.96 490.741 0
create vertex -1750.00 470.37 0

create vertex -1659.26 1014.81 0
create vertex -1624.07 938.889 0
create vertex -1618.52 842.593 0
create vertex -1627.78 761.111 0
create vertex -1683.33 642.593 0
create vertex -1733.33 581.481 0
create vertex -1735.19 551.852 0
create vertex -1798.15 450 0

create vertex -1798.15 400 0 
create vertex -1000 400 0
create vertex -1000 1020 0 
create vertex -1798.15 1020 0

create curve vertex 223  vertex 222  on surface 
create curve vertex 222 vertex 225 on surface
create curve vertex 225 vertex 224 on surface
create curve vertex 224 vertex 223 on surface

create surface curve 1 2 3 4
brick x 1000 y 1000 z 1000
align volume 2 surface 2 with surface 1
delete surface 1

create vertex on curve 6 8 segment 18 color

create curve spline vertex 238 1 2 3 4 5 6 7 8 9 10 11 12 271
create curve spline vertex 239 13 14 15 16 17 18 19 20 21 22 23 24 270
create curve spline vertex 240 25 26 27 28 29 30 31 32 33 34 35 269
create curve spline vertex 241 36 37 38 39 40 41 42 43 44 45 46 268
create curve spline vertex 242 47 48 49 50 51 52 53 54 55 56 57 58 267
create curve spline vertex 243 59 60 61 62 63 64 65 66 67 68 69 70 71 266
create curve spline vertex 244 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 265
create curve spline vertex 245 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 264
create curve spline vertex 246 104 105 106 107 108 109 110 111 112 113 114 115 263
create curve spline vertex 247 116 117 118 119 120 121 122 123 124 125 126 262
create curve spline vertex 248 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 261
create curve spline vertex 249 144 145 146 147 148 149 150 151 152 153 154 155 260
create curve spline vertex 250 156 157 158 159 160 161 162 163 164 165 166 167 168 259
create curve spline vertex 251 169 170 171 172 173 174 175 176 177 178 179 258
create curve spline vertex 252 180 181 182 183 184 185 186 187 188 189 190 257
create curve spline vertex 253 191 192 193 194 195 196 197 198 199 200 201 202 256
create curve spline vertex 254 203 204 205 206 207 208 209 210 211 212 213 255
create curve spline vertex 232 214 215 216 217 218 219 220 221 233

webcut volume 2 with plane yplane offset 400 noimprint nomerge
webcut volume 3 with plane yplane offset 1050 noimprint nomerge
delete volume 2 4
imprint volume 3 with curve all
delete free curve all
delete free vertex all

webcut volume 3  with plane zplane offset -734 noimprint nomerge 
webcut volume 3  with plane zplane offset -660 noimprint nomerge 
webcut volume 3  with plane zplane offset -640 noimprint nomerge 
webcut volume 3  with plane zplane offset -620 noimprint nomerge 
webcut volume 3  with plane zplane offset -600 noimprint nomerge 
webcut volume 3  with plane zplane offset -560 noimprint nomerge 
webcut volume 3  with plane zplane offset -540 noimprint nomerge 
webcut volume 3  with plane zplane offset -520 noimprint nomerge 
webcut volume 3  with plane zplane offset -500 noimprint nomerge 

Surface 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  copy move x 0 y 0 z -500 
Surface 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  copy move x 0 y 0 z -520 
Surface 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  copy move x 0 y 0 z -540 
Surface 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  copy move x 0 y 0 z -560 
Surface 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  copy move x 0 y 0 z -600 
Surface 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  copy move x 0 y 0 z -620 
Surface 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  copy move x 0 y 0 z -640 
Surface 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  copy move x 0 y 0 z -660 
Surface 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  copy move x 0 y 0 z -734

unite volume 50 49  
unite volume 51 33  
unite volume 69 68 67  
unite volume 70 52 53  
unite volume 88 87 86 85  
unite volume 89 71 72 73  
unite volume 107 106 105 104 103  
unite volume 108 90 91 92 93  
unite volume 126 125 124 123 122 121  
unite volume 127 109 110 111 112 113  
unite volume 145 144 143 142 141 140 139  
unite volume 146 128 129 130 131 132 133  
unite volume 164 163 162 161 160 159 158 157  
unite volume 165 147 148 149 150 151 152 153  
unite volume 183 182 181 180 179 178 177 176 175  
unite volume 184 166 168 167 169 170 171 172 173  

create volume loft surface 306  287  
create volume loft surface 287  268  
create volume loft surface 268  249  
create volume loft surface 321  230  
create volume loft surface 230  211  
create volume loft surface 333  192  
create volume loft surface 339  173  
create volume loft surface 345  154  
 
create volume loft surface 307  288  
create volume loft surface 288  269  
create volume loft surface 269  250  
create volume loft surface 369  231  
create volume loft surface 375  212  
create volume loft surface 381  193  
create volume loft surface 387  174  
create volume loft surface 393  155  

delete volume 3 6 7 8 9 10 11 12 13 50 51 69 70 88 89 107 108 126 127 145 146 164 165 183 184
delete body 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 54 55 56 57 58 59 60 61 62 63 64 65 66 74 75 76 77 78 79 80 81 82 83 84 94 95 96 97 98 99 100 101 102 114 115 116 117 118 119 120 134 135 136 137 138 154 155 156 174

unite volume all 

webcut volume 5 with plane yplane offset 420 noimprint nomerge 
webcut volume 201  with plane yplane offset 1020 noimprint nomerge 
delete volume 5 202
webcut volume 201  with plane xplane offset -1000 noimprint nomerge 
webcut volume 203  with plane xplane offset -1850 noimprint nomerge
delete volume 201 204

#GEOMETRY CREATED

create vertex -1410 850 500 color 
create vertex -1410 825 500 color 
create vertex -1410 832 720 color 
create vertex -1410 825 720 color 

create vertex -1410 855 575 color #Change y values to vary U/S vertical curvature
create vertex -1410 830 575 color #Change y values to vary D/S vertical curvature

create curve vertex 1454  vertex 1452  vertex 1456  parabolic
create curve vertex 1453  vertex 1451  vertex 1455  parabolic

#Create toe of dam
create vertex -1410 860 490
create vertex -1410 815 490
create vertex -1410 860 480
create vertex -1410 815 480
create curve vertex 1451  vertex 1457  
create curve vertex 1452  vertex 1458  
create curve vertex 1458  vertex 1460  
create curve vertex 1457  vertex 1459  

create vertex -1150 745 575 color #Change y values to vary curvature
create vertex -1650 745 575 color #Change y values to vary curvature
create curve vertex 1466  vertex 1465  vertex 1456  parabolic

sweep curve 1570 1571 1572 1573 1574 1575 along curve 1576

create volume loft surface 582  581  
create volume loft surface 583  584  
create curve vertex 1490  vertex 1486  
create curve vertex 1483  vertex 1487  
create surface curve 1596 1626 1600 1625  
create volume loft surface 598  599  

unite volume 211 212 214

delete body 205 206 207 208 209 210 213
delete free curve all
delete vertex all

align Volume 211  surface 601 with surface 494 
move Volume 211  z -20 include_merged
move Volume 211 y 60 include_merged

webcut volume 211 with plane xplane offset -750 rotate 40 about y noimprint nomerge
webcut volume 215  with plane xplane offset -2070 rotate -40 about y noimprint nomerge 

delete volume 211 216

imprint volume 203  with volume 215
chop volume 203  with volume 215 keep 

delete volume  203 217

color Volume 218 limegreen
color Volume 215 grey

# Imprint and merge
imprint volume all
merge volume all 

#Valey 
delete volume 218

##Valley elastic properties
#block 2 volume 218
#block 2 name "MAT_ELASTIC_VAL"
#block 2 attribute count 2
##Unit MPa
#block 2 attribute index 1 6.0e+4
#block 2 attribute index 2 0.2
#
##Damping 
#block 4 volume 218
#block 4 name "DAMPER_VAL")
#block 4 attribute count 2
#block 4 attribute index 1  3.8400e+03 # eta = 0.4, value eta*G=eta*E/2*(1+nu)
#block 4 attribute index 2 -1 # only shear damping, no volumetric
#
##displacement constrain on bottom surface
#create Displacement 1 on surface 743  dof 3 fix 0
#create Displacement 2 on surface 747 750  dof 1 fix 0
#create Displacement 2 on surface 749 744  dof 2 fix 0
#
##Apply Water Pressure inside 
#block 5 surface 751 753 756 758 760 762 764 766 768 770 772 774 776 778 780 697  
#block 5 name 'FLUID_PRESSURE'  
#block 5 attribute count 7   
#block 5 attribute index 1 0.001	#density of Water [1kg/m^3  = N*(m/s^2) / m^3 =  1e-6 M]   
#block 5 attribute index 2 0 		#acceleration x-direction  
#block 5 attribute index 3 0 		#acceleration y-direction  
#block 5 attribute index 4 -9.81 	#acceleration z-direction  
##zero pressure point - water level at which water pressure is zero  
#block 5 attribute index 5 0 		#pressure point x-direction  
#block 5 attribute index 6 0 		#pressure point y-direction  
#block 5 attribute index 7 -530 	#pressure point z-direction  

#DAM CREATED

##Applying Boundary Conditions
#Dam elastic properties
block 1 volume 215
block 1 name "MAT_ELASTIC_DAM"
block 1 attribute count 2
# Note that base init is Mega Pascal  MPa
block 1 attribute index 1 2.6e+4 
block 1 attribute index 2 0.2

#Damping  
block 3 volume 215 
block 3 name "DAMPER_DAM") 
block 3 attribute count 2 
block 3 attribute index 1 312 # eta = 0.04, value eta*G=eta*E/2*(1+nu) 
block 3 attribute index 2 -1 # only shear damping, no volumetric 

###Apply Water Pressure inside 
#block 5 surface  697   
#block 5 name 'FLUID_PRESSURE'   
#block 5 attribute count 7    
#block 5 attribute index 1 0.001	#density of Water [1kg/m^3  = N*(m/s^2) / m^3 =  1e-6 M]    
#block 5 attribute index 2 0 		#acceleration x-direction   
#block 5 attribute index 3 0 		#acceleration y-direction   
#block 5 attribute index 4 -9.81 	#acceleration z-direction   
##zero pressure point - water level at which water pressure is zero   
#block 5 attribute index 5 0 		#pressure point x-direction   
#block 5 attribute index 6 0 		#pressure point y-direction   
#block 5 attribute index 7 -530 	#pressure point z-direction   

block 6 volume all
block 6 name "BODY_FORCES")
block 6 attribute count 4
block 6 attribute index 1 0.00230	
block 6 attribute index 2 0.
block 6 attribute index 3 0.
block 6 attribute index 4 -10

create Displacement 1 on surface 692 691 628 627 624 698 693 615 625 630 626  dof 1 2 3 fix 0

##mesh the geometry
volume all scheme Tetmesh
volume all size auto factor 6
#volume 215 size auto factor 7
mesh volume all

#block 7 tet all        
#block 7 element type tetra10  


